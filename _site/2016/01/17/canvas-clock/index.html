<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      粒子时钟 &middot; 高悦凯的博客
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://gyk6985432.github.io/myBlog/css/poole.css">
  <link rel="stylesheet" href="http://gyk6985432.github.io/myBlog/css/syntax.css">
  <link rel="stylesheet" href="http://gyk6985432.github.io/myBlog/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><!--icon-->

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://gyk6985432.github.io/myBlog/images/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://gyk6985432.github.io/myBlog/images/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

<!--插入的代码_百度统计-->
  <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?9ab1df26e131dafc619a1e9f8cff0170";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
    })();
  </script>

<!--插入的代码_谷歌统计-->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-71637553-1', 'auto');
  ga('send', 'pageview');
</script>

</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <img src="http://gyk6985432.github.io/myBlog/images/apple-touch-icon-precomposed.png">
    <p>走在编程的大路上……</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="http://gyk6985432.github.io/myBlog/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
    
      
        
      
    
      
        
      
    

    <span class="sidebar-nav-item" href="">gyk6985432@gmail.com</span>
    <a class="sidebar-nav-item" href="https://twitter.com/gyk6985432">Twitter</a>
    <a class="sidebar-nav-item" href="https://www.facebook.com/profile.php?id=100009369283784">Facebook</a>

    <span class="sidebar-nav-item">Template：lanyon</span>
  </nav>

  <div class="sidebar-item">
    <p>
      gyk6985432&copy; 2016. All rights reserved.
    </p>
  </div>
</div>


    <!--回到顶端-->
    <a name="toTop" href="top"></a>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h2 class="masthead-title">
            <a href="http://gyk6985432.github.io/myBlog/" title="Home">高悦凯的博客</a>
            <small>后端为主，前端为辅</small>
          </h2>
        </div>
      </div>
    </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">粒子时钟</h1>
  <span class="post-date">17 Jan 2016</span>
  在慕课网上学了个动态时钟，全部用canvas实现的。
自己改成了一个粒子时钟，放上来玩玩。



<canvas id="canvas">
    您的浏览器不支持canvas，请更换浏览器
</canvas>
<script type="text/javascript">
    digit =
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0],
            [0,0,0,0],
            [0,1,1,0],
            [0,1,1,0],
            [0,0,0,0],
            [0,0,0,0],
            [0,1,1,0],
            [0,1,1,0],
            [0,0,0,0],
            [0,0,0,0]
        ]//:
    ];

var WINDOW_WIDTH = 1024;
var WINDOW_HEIGHT = 768;
var RADIUS = 6;
var DOT_RADIUS = Math.round(RADIUS/5);
var MARGIN_TOP = 100;
var MARGIN_LEFT = 200;
var endTime = new Date();
endTime.setTime(endTime.getTime() + 3600*1000);
var currentShowTimeSeconds=0;

var balls = [];
//var colors = ["#008000","#00ffff","#FF7F50","#DC143","#00008B","#DC143C","#FF8C00","#E9967A","#008000","##9ACD32"];
var colors = ["#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","##000000"];

window.onload = function(){

    WINDOW_WIDTH = Math.round(document.body.clientWidth*1.5);
    WINDOW_HEIGHT=Math.round(document.body.clientHeight*1.5);
    //屏幕自适应
    // WINDOW_WIDTH = document.getElementById("main").offsetWidth;
    // WINDOW_HEIGHT=document.getElementById("main").offsetHeight;
    // MARGIN_LEFT = Math.floor(WINDOW_WIDTH/10);
    MARGIN_LEFT = 0;
    MARGIN_TOP = Math.floor(WINDOW_HEIGHT/5);
    //RADIUS = Math.floor(WINDOW_WIDTH*3/5/108)-1;
    RADIUS=5;
    DOT_RADIUS = Math.floor(RADIUS/5);

    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");

    canvas.width = WINDOW_WIDTH;
    canvas.height = WINDOW_HEIGHT;

    currentShowTimeSeconds = getCurrentShowTimeSeconds();
    setInterval(function(){
        render(context);
        update();
    },50);
}

function render(cxt){
    cxt.clearRect(0,0,WINDOW_WIDTH,WINDOW_HEIGHT);

    var hour = parseInt(currentShowTimeSeconds/3600);
    var minite = parseInt((currentShowTimeSeconds-hour*3600)/60);
    var second = currentShowTimeSeconds%60;

    renderDigit(MARGIN_LEFT,MARGIN_TOP,parseInt(hour/10),cxt);//位置，数字，cxt  parseInt(minite/10)
    renderDigit(MARGIN_LEFT+15*(RADIUS+1),MARGIN_TOP,parseInt(hour%10),cxt);
    renderDigit(MARGIN_LEFT+30*(RADIUS+1),MARGIN_TOP,10,cxt);
    renderDigit(MARGIN_LEFT+39*(RADIUS+1),MARGIN_TOP,parseInt(minite/10),cxt);
    renderDigit(MARGIN_LEFT+54*(RADIUS+1),MARGIN_TOP,parseInt(minite%10),cxt);
    renderDigit(MARGIN_LEFT+69*(RADIUS+1),MARGIN_TOP,10,cxt);
    renderDigit(MARGIN_LEFT+78*(RADIUS+1),MARGIN_TOP,parseInt(second/10),cxt);
    renderDigit(MARGIN_LEFT+93*(RADIUS+1),MARGIN_TOP,parseInt(second%10),cxt);

    for (var i = 0; i < balls.length; i++) {
        cxt.fillStyle=balls[i].color;
        cxt.beginPath();
        cxt.arc(balls[i].x,balls[i].y,balls[i].r,0,2*Math.PI);
        cxt.closePath;
        cxt.fill();
    };
}

function renderDigit(x, y, num, cxt){       //centerX=x+j*2(R+1)+(R+1)      centerY = y+i*2(R+1)+(R+1)

    cxt.fillStyle = "rgb(0,0,0)";

    for (var i = 0; i < digit[num].length; i++) {
        for (var j = 0; j < digit[num][i].length; j++) {
            if (digit[num][i][j]==1) {
                for (var k = 0; k < 5; k++) {
                    for (var l = 0; l < 5; l++) {
                        cxt.beginPath();
                        cxt.arc(x+j*2*(RADIUS+1)+(RADIUS+1)+l*2*(DOT_RADIUS+1)+(DOT_RADIUS+1),y+i*2*(RADIUS+1)+(RADIUS+1)+k*2*(DOT_RADIUS+1)+(DOT_RADIUS+1),DOT_RADIUS,0,2*Math.PI);
                        cxt.closePath();
                        cxt.fill();
                    };
                };
                // cxt.beginPath();
                // cxt.arc(x+j*2*(RADIUS+1)+(RADIUS+1),y+i*2*(RADIUS+1)+(RADIUS+1),RADIUS,0,2*Math.PI);
                // cxt.closePath();
                // cxt.fill();
            };
        };
    };

}

function getCurrentShowTimeSeconds(){
    var currTime = new Date();
    //倒计时
    // var ret = endTime.getTime() - currTime.getTime();
    // ret = Math.round(ret/1000);
    // return ret>=0 ? ret : 0;

    //时钟
    var ret = currTime.getHours()*3600+currTime.getMinutes()*60+currTime.getSeconds();
    return ret;
}

function update(){
    var nextShowTimeSeconds = getCurrentShowTimeSeconds();

    var nextHour = parseInt(nextShowTimeSeconds/3600);
    var nextMinite = parseInt((nextShowTimeSeconds-nextHour*3600)/60);
    var nextSecond = nextShowTimeSeconds%60;

    var curHour = parseInt(currentShowTimeSeconds/3600);
    var curMinite = parseInt((currentShowTimeSeconds-curHour*3600)/60);
    var curSecond = currentShowTimeSeconds%60;

    if (nextSecond != curSecond) {

        if (parseInt(curHour/10) != parseInt(nextHour/10)) {
            addBalls(MARGIN_LEFT,MARGIN_TOP,parseInt(curHour/10));
        };
        if (parseInt(curHour%10) != parseInt(nextHour%10)) {
            addBalls(MARGIN_LEFT+15*(RADIUS+1),MARGIN_TOP,parseInt(curHour%10));
        };
        if (parseInt(curMinite/10) != parseInt(nextMinite/10)) {
            addBalls(MARGIN_LEFT+39*(RADIUS+1),MARGIN_TOP,parseInt(curMinite/10));
        };
        if (parseInt(curMinite%10) != parseInt(nextMinite%10)) {
            addBalls(MARGIN_LEFT+54*(RADIUS+1),MARGIN_TOP,parseInt(curMinite%10));
        };
        if (parseInt(curSecond/10) != parseInt(nextSecond/10)) {
            addBalls(MARGIN_LEFT+78*(RADIUS+1),MARGIN_TOP,parseInt(curSecond/10));
        };
        if (parseInt(curSecond%10) != parseInt(nextSecond%10)) {
            addBalls(MARGIN_LEFT+93*(RADIUS+1),MARGIN_TOP,parseInt(curSecond%10));
        };
        currentShowTimeSeconds = nextShowTimeSeconds;
    };
    updateBalls();
}

function addBalls(x,y,num){
    for (var i = 0; i < digit[num].length; i++) {
        for (var j = 0; j < digit[num][i].length; j++) {
            if (digit[num][i][j]==1) {
                for (var k = 0; k < 10; k++) {
                    var aBall={
                    x:x+j*2*(RADIUS+1)+(RADIUS+1),
                    y:y+i*2*(RADIUS+1)+(RADIUS+1),
                    g:1.5+Math.random(),
                    vx:Math.pow(-1,Math.ceil(Math.random()*1000))*Math.floor(Math.random()*30),
                    vy:Math.pow(-1,Math.ceil(Math.random()*1000))*Math.floor(Math.random()*30),
                    r:DOT_RADIUS,
                    color: colors[Math.floor(Math.random()*colors.length)]
                    };
                    balls.push(aBall);
                };
            };
        };
    };
}

function updateBalls(){
    //console.log(balls.length);

    for (var i = 0; i < balls.length; i++) {
        balls[i].x += balls[i].vx;
        balls[i].y += balls[i].vy;
        balls[i].vy += balls[i].g;

        if (balls[i].y >= WINDOW_HEIGHT-RADIUS) {
            balls[i].y=WINDOW_HEIGHT-RADIUS;
            //balls[i].vy = -balls[i].vy*0.75;
        };
        if (balls[i].vx==0) {
            balls[i].vx -= 5;
        };
    };

    //删掉不在画面中的小球，提高性能
    var cnt=0;
    for (var i = 0; i < balls.length; i++) {
        if(balls[i].x+RADIUS > 0 && balls[i].x-RADIUS<WINDOW_WIDTH){
            balls[cnt++] = balls[i];
        }
    };

    while(balls.length > cnt){ //|| balls.length>300){//Math.min(300,cnt)
        balls.pop();
    }
}
</script>

</div>




<!--插入的代码_disqus的评论
<div id="disqus_thread"></div>
<script>
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//gyk6985432.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
-->

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="http://gyk6985432.github.io/myBlog/2016/03/14/gem-errors/">
            安装jekyll问题解决方案
            <small>14 Mar 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://gyk6985432.github.io/myBlog/2016/03/10/atom-install-error/">
            atom安装插件的问题
            <small>10 Mar 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://gyk6985432.github.io/myBlog/2016/01/23/story-of-ubuntu-and-me/">
            与ubuntu一见钟情的故事
            <small>23 Jan 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


        <!--友言评论-->
        <div id="uyan_frame"></div>
        <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2077210"></script>
        </div>

        <div class="toTop">
          <a name="top" href="#toTop"><i class="fa fa-chevron-up"></i></a>
        </div>
      </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>


    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
